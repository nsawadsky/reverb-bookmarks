<html>
<embed type="application/x-periscope" id="periscopePlugin"></embed>
<script>
function initializePlugin() {
	var plugin = document.getElementById("periscopePlugin");
	if (plugin == null) {
	  console.log("Failed to get plugin reference");
	  return;
	}
	if (!plugin.startBackgroundThread()) {
	  console.log("Failed to start background thread: " + plugin.getErrorMessage());
	  return;
	}
	chrome.extension.onRequest.addListener(
	    function(request, sender, sendResponse) {
	      if (!plugin.sendPage(request.url, request.page)) {
	        console.log("Failed to send page: " + plugin.getErrorMessage());
	        console.log("Background thread status: " + plugin.getBackgroundThreadStatus());
	      }
	      sendResponse({});
	    }
	);
}
initializePlugin();
</script>
</html>